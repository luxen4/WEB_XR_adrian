<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/jeromeetienne/AR.js/aframe/build/aframe-ar.js"></script>

    <title>Pokemon AR - Sonido al Tocar</title>

    <style>
        body { margin: 0; overflow: hidden; }
        a-scene { width: 100%; height: 100%; }
    </style>
</head>

<body>
    <a-scene embedded arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;">
        <!-- Marcador para detectar el modelo de Pokémon -->
        <a-marker preset="kanji">
            <!-- Modelo de Pokémon -->
            <a-entity id="pokemon"
                      gltf-model="url(charmander.glb)" 
                      scale="0.5 0.5 0.5" 
                      position="0 0 -3"  <!-- Modelo ligeramente alejado -->
                      rotation="0 180 0"
                      touch-start="enabled: true"
                      sound="src: url(pokemon-sound.mp3); autoplay: false; volume: 1;"
                      class="movable">
            </a-entity>
        </a-marker>

        <!-- Cámara AR -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Componente personalizado para mover y rotar el modelo con el dedo
        AFRAME.registerComponent('touch-start', {
            init: function () {
                this.isDragging = false; // Controla si se está moviendo el modelo
                this.lastTouch = { x: 0, y: 0 }; // Última posición del toque
                this.el.addEventListener('touchstart', this.onTouchStart.bind(this));
                this.el.addEventListener('touchmove', this.onTouchMove.bind(this));
                this.el.addEventListener('touchend', this.onTouchEnd.bind(this));
                this.el.addEventListener('click', this.onClick.bind(this)); // Evento para tocar el modelo
            },

            onTouchStart: function (event) {
                this.isDragging = true;
                this.lastTouch = { x: event.touches[0].pageX, y: event.touches[0].pageY };
            },

            onTouchMove: function (event) {
                if (this.isDragging) {
                    // Desplazamiento en la pantalla
                    const deltaX = event.touches[0].pageX - this.lastTouch.x;
                    const deltaY = event.touches[0].pageY - this.lastTouch.y;

                    // Movimiento en el eje X y Y basado en el desplazamiento
                    let position = this.el.getAttribute('position');
                    position.x += deltaX * 0.01; // Ajuste de velocidad
                    position.y -= deltaY * 0.01; // Ajuste de velocidad
                    this.el.setAttribute('position', position);

                    // Rotación en el eje Y (giro sobre sí mismo)
                    let rotation = this.el.getAttribute('rotation');
                    rotation.y += deltaX * 0.1; // Giro más rápido sobre el eje Y
                    this.el.setAttribute('rotation', rotation);

                    // Actualizamos la última posición registrada
                    this.lastTouch = { x: event.touches[0].pageX, y: event.touches[0].pageY };
                }
            },

            onTouchEnd: function () {
                this.isDragging = false;
            },

            onClick: function () {
                // Reproducir el sonido cuando el modelo es tocado
                this.el.components.sound.playSound();
            }
        });
    </script>
</body>
</html>